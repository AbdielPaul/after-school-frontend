<!DOCTYPE html>
<html>
<head>
  <title>After School Classes</title>
  <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome-bundled@6.7.2/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <header>
      <h1>After School Classes</h1>
      <button class="checkout-btn" v-on:click="toggleCheckout" v-if="cartItemCount > 0">
        <span>{{ cartItemCount }}</span>
        <span class="fa-solid fa-cart-shopping"></span>
        <span>Checkout</span>
      </button>
    </header>

    <main>
      <!-- PRODUCT PAGE -->
      <div v-if="showProduct">
        <div class="container">
          <!-- LEFT SIDE: Sorting Options -->
          <div class="sidebar">

            <!-- ðŸ” SEARCH BOX -->
            <h2>Search</h2>
            <input
              type="text"
              v-model="searchQuery"
              placeholder="Search by subject or location"
              class="search-box"
            />

            <h2>Sort by</h2>
            
            <!-- What to sort by -->
            <div class="sort-group">
              <div class="radio-option">
                <input type="radio" id="subject" value="subject" v-model="sortBy"/>
                <label for="subject" :class="{ bold: sortBy === 'subject' }">Subject</label>
              </div>
              
              <div class="radio-option">
                <input type="radio" id="location" value="location" v-model="sortBy"/>
                <label for="location" :class="{ bold: sortBy === 'location' }">Location</label>
              </div>
              
              <div class="radio-option">
                <input type="radio" id="price" value="price" v-model="sortBy"/>
                <label for="price" :class="{ bold: sortBy === 'price' }">Price</label>
              </div>
              
              <div class="radio-option">
                <input type="radio" id="spaces" value="spaces" v-model="sortBy"/>
                <label for="spaces" :class="{ bold: sortBy === 'spaces' }">Availability</label>
              </div>
            </div>
            
            <!-- How to sort (ascending/descending) -->
            <div class="sort-group">
              <div class="radio-option">
                <input type="radio" id="ascending" value="ascending" v-model="sortOrder"/>
                <label for="ascending" :class="{ bold: sortOrder === 'ascending' }">Ascending</label>
              </div>
              
              <div class="radio-option">
                <input type="radio" id="descending" value="descending" v-model="sortOrder"/>
                <label for="descending" :class="{ bold: sortOrder === 'descending' }">Descending</label>
              </div>
            </div>
          </div>

          <!-- RIGHT SIDE: Class Cards -->
          <div class="content">
            <div class="cards-grid">
              <!--  UPDATED TO USE filteredProducts -->
              <div v-for="product in filteredProducts" class="card">
                <div class="card-header">
                  <div class="card-info">
                    <div><strong>Subject:</strong> {{ product.subject }}</div>
                    <div><strong>Location:</strong> {{ product.location }}</div>
                    <div><strong>Price:</strong> Â£{{ product.price }}</div>
                    <div><strong>Spaces:</strong> {{ availableSpaces(product.id) }}</div>
                  </div>
                  <div class="card-icon">
                    <img :src="getImage(product.subject)" :alt="product.subject">
                  </div>
                </div>
                
                <button class="add-to-cart" v-on:click="addToCart(product)" :disabled="!canAddToCart(product)">
                  Add to cart
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CHECKOUT PAGE -->
      <div v-else>
        <div class="checkout-page">
          <h2>Checkout</h2>
          
          <div v-if="cartItemCount > 0">
            <!-- Cart Items Display -->
            <div class="cart-items">
              <h3>Your Cart Items</h3>
              <div v-for="item in cartItems" class="cart-item">
                <img :src="getImage(item.product.subject)" :alt="item.product.subject" class="cart-item-image">
                <div class="cart-item-info">
                  <div><strong>{{ item.product.subject }}</strong></div>
                  <div>Location: {{ item.product.location }}</div>
                  <div>Price per unit: Â£{{ item.product.price }}</div>
                </div>
                <div class="quantity-controls">
                  <button class="quantity-btn" v-on:click="decreaseQuantity(item.product.id)" :disabled="item.quantity <= 1">-</button>
                  <span class="quantity-display">{{ item.quantity }}</span>
                  <button class="quantity-btn" v-on:click="increaseQuantity(item.product.id)" :disabled="!canIncreaseQuantity(item.product.id)">+</button>
                </div>
                <button class="remove-btn" v-on:click="removeFromCart(item.product.id)">Remove</button>
                <div class="cart-item-price">
                  Â£{{ (item.product.price * item.quantity).toFixed(2) }}
                </div>
              </div>
              <div class="cart-total">
                <strong>Total: Â£{{ cartTotal }}</strong>
              </div>
            </div>
            
            <div class="form-group">
              <label>First Name: <span style="color: red;">*</span></label>
              <input v-model="order.firstName" type="text" :class="{ error: errors.firstName }" @blur="validateField('firstName')"/>
              <div v-if="errors.firstName" class="error-message">{{ errors.firstName }}</div>
            </div>
            
            <div class="form-group">
              <label>Last Name: <span style="color: red;">*</span></label>
              <input v-model="order.lastName" type="text" :class="{ error: errors.lastName }" @blur="validateField('lastName')"/>
              <div v-if="errors.lastName" class="error-message">{{ errors.lastName }}</div>
            </div>
            
            <div class="form-group">
              <label>Address: <span style="color: red;">*</span></label>
              <input v-model="order.address" type="text" :class="{ error: errors.address }" @blur="validateField('address')"/>
              <div v-if="errors.address" class="error-message">{{ errors.address }}</div>
            </div>
            
            <div class="form-group">
              <label>City: <span style="color: red;">*</span></label>
              <input v-model="order.city" type="text" :class="{ error: errors.city }" @blur="validateField('city')"/>
              <div v-if="errors.city" class="error-message">{{ errors.city }}</div>
            </div>
            
            <div class="form-group">
              <label>State: <span style="color: red;">*</span></label>
              <select v-model="order.state" :class="{ error: errors.state }" @blur="validateField('state')">
                <option disabled value="">Select State</option>
                <option v-for="(state, key) in states" :value="state">
                  {{ key }}
                </option>
              </select>
              <div v-if="errors.state" class="error-message">{{ errors.state }}</div>
            </div>
            
            <div class="form-group">
              <label>Zip/Postal Code: <span style="color: red;">*</span></label>
              <input v-model="order.zip" type="text" :class="{ error: errors.zip }" @blur="validateField('zip')"/>
              <div v-if="errors.zip" class="error-message">{{ errors.zip }}</div>
            </div>
            
            <div class="checkbox-group">
              <input type="checkbox" id="gift" v-model="order.gift"/>
              <label for="gift">This is a gift</label>
            </div>
            
            <div class="radio-group">
              <label style="display: block; margin-bottom: 10px; font-weight: 600;">Delivery Method:</label>
              <div class="radio-inline">
                <input type="radio" id="home" value="Home" v-model="order.method"/>
                <label for="home">Home</label>
              </div>
              <div class="radio-inline">
                <input type="radio" id="business" value="Business" v-model="order.method"/>
                <label for="business">Business</label>
              </div>
            </div>
            
            <div class="order-summary">
              <h3>Order Summary</h3>
              <p><strong>First Name:</strong> {{ order.firstName }}</p>
              <p><strong>Last Name:</strong> {{ order.lastName }}</p>
              <p><strong>Address:</strong> {{ order.address }}</p>
              <p><strong>City:</strong> {{ order.city }}</p>
              <p><strong>State:</strong> {{ order.state }}</p>
              <p><strong>Zip:</strong> {{ order.zip }}</p>
              <p><strong>Delivery Method:</strong> {{ order.method }}</p>
              <p><strong>Gift:</strong> {{ order.gift ? 'Yes' : 'No' }}</p>
              <p><strong>Items in Cart:</strong> {{ cartItemCount }}</p>
            </div>
            
            <div class="button-group">
              <button class="btn-primary" v-on:click="submitForm" :disabled="!isFormValid">Place Order</button>
              <button class="btn-secondary" v-on:click="toggleCheckout">Continue Shopping</button>
            </div>
          </div>
          
          <div v-else class="empty-cart">
            <p style="font-size: 18px;">Your cart is empty</p>
            <button class="btn-primary" v-on:click="toggleCheckout" style="margin-top: 20px;">Continue Shopping</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="lessons.js"></script>
  <script src="app.js"></script>
</body>
</html>